<div id ="report" v-cloak>
    <h1>Harvest Report</h1>
    <br />
    <label for = "title">Title</label>
    <input name = "title" type = "text" id = "title" v-model  = "rptTitle"/>
    
    <br />
    <br />
    <label for="start">Start</label>
    <input type="date" id="start" name="Start Date"
           v-model = "rptStartDate"
           min="2014-01-01" :max="rptEndDate">
    <label for="end">End</label>
    <input type="date" id="end" name="End-Date"
           v-model = "rptEndDate"
           :min="rptStartDate" max="2022-01-01">
    <br />
    <br />
    <label for = "crop">Crop</label>
    <select id = "crop" name = "crop" v-model = "rptCrop">
        <option v-for = "crop in cropNames">{{crop}}</option>
    
    </select>
    
    <label for = "field">Area</label>
    <select id = "field" name = "field" >
        <option v-for ="area in areaNames">{{area}}</option>
    </select>
    <br >
    <br />
    <button type = "submit" @click = 'saveHarvest'> Generate Report </button>
    <br />
    <br />
    <hr />
    
    <h1>{{ rptTitle== ''?'Mock Harvest Report':rptTitle }}</h1>
    
    
    <br />
    <br />
    
    <p>Details:</p>
    <ul>
        <li><strong>Farm: </strong>{{farm}}</li>
        <li><strong>User: </strong>{{user}}</li>
        <li><strong>Language: </strong>{{language}}</li>
        <br />
        <br />
        <li><strong>Start: </strong>{{ rptStartDate }}</li>
        <li><strong>End: </strong>{{ rptEndDate }}</li>
        <li><strong>Crop: </strong>{{rptCrop}}</li>
        
    </ul>
    <br />
    <p v-if = "harvestLog.length===0">No matching Records</p>
    <table v-if = "harvestLog.length>0" border = "1">
        
        <th><strong>Row</strong></th>
        <th><strong>Date</strong></th>
        <th><strong>Area</strong></th>
        <th><strong>Crop</strong></th>
        <th><strong>Yield</strong></th>
        <th><strong>Units</strong></th>
        <tr v-for = "(harvest, index) in harvestLog">
            <td>{{index+1}}</td>
            <td>{{harvest.date}}</td>
            <td>{{harvest.area}}</td>
            <td>{{harvest.crop}}</td>
            <td>{{harvest.yield}}</td>
            <td>{{harvest.units}}</td>
        </tr>
      
    </table>
    </div>
    <script>
    
        var myPage = new Vue({
                el: "#report",
                data: {
                    rptTitle: "My Sample Harvest Report",
                    rptStartDate : "2020-05-05",
                    rptEndDate : "2020-05-15",
                    rptCrop: "Kale",
    
                    
                    
                    harvestLog: [],
                    farm:"",
                    user:"",
                    language:"",
                    idToCropMap: new Map(),
                    idToAreaMap: new Map(),
                    //allPages:["ds"],
                    allHarvestPage:[],

                    
                },
                computed:{
                    cropNames(){
                        return Array.from(this.idToCropMap.values());
                    },
                    areaNames(){
                        return Array.from(this.idToAreaMap.values());
                    }

                },

                methods:{
                    saveHarvest: function(){

                        axios.get('/farm.json')
                        .then((response) =>{
                            this.farm = response.data.name;
                            this.user = response.data.user.name;
                            this.language =response.data.languages.en.name;
                        })
                        .catch((error)=>{
                            console.log('Error Occurred')
                            console.log(error)
                        })
                        if(this.harvestLog.length==0){
                            this.harvestLog.push({date: "2018-05-01",area: "Orion-3", crop: "Kale",yield:12, units: "Bunches"})
                        }

                        let startTimeStamp = dayjs(this.rptStartDate).unix();
                        let endTimeStamp = dayjs(this.rptEndDate).unix();

                        let x = "/log.json?type=farm_harvest&timestamp[ge]="+startTimeStamp+"&timestamp[le]="+endTimeStamp;
                        console.log(x);
                        getAllPages(x,this.allHarvestPage)
                        .then(()=>{
                            //console.log(this.allHarvestPage);
                           
                            
                        })
                        .catch((error)=>{
                            console.log(error);
                        })

                        
                    },
                },

                created(){
                    getIDToCropMap()
                    .then((theMap)=>{
                        //console.log(theMap);
                        this.idToCropMap = theMap;
                        
                    })
                    .catch((error)=>{
                        console.log(error)
                    })

                    getIDToAreaMap()
                    .then((theMap)=>{
                        //console.log(theMap);
                        this.idToAreaMap = theMap;
                        
                    })
                    .catch((error)=> {
                        console.log(error);
                    })
                },

            });
            Vue.config.devtools = true
        </script>