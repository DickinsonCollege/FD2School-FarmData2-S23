<h1>Harvest Report</h1>
<p>This page is a <em>mockup</em> of a simplified harvest report.</p>
<div id="report">
  <label for="title">Title:</label>
  <input type="text" id="title" name="Title" v-model="header" />
  <br />
  <label for="start">Start:</label>
  <input
    type="date"
    id="start"
    name="start"
    v-model="startDate"
    v-bind:min="startDate"
    v-bind:max="endDate"
  />
  <label for="end">End:</label>
  <input
    type="date"
    id="end"
    name="end"
    v-model="endDate"
    v-bind:min="startDate"
    v-bind:max="endDate"
  />
  <br />
  <label for="crop">Crop:</label>
  <select id="crop" v-model="rpCrops">
    <option v-for="crop in cropNames" :value="crop">{{crop}}</option>
  </select>
  <label for="area">Area:</label>
  <select id="area">
    <option v-for="area in areaNames" :value="area">{{area}}</option>
  </select>
  <br />
  <br />
  <button type="button" v-on:click="setUserInfo(); logHarvests(); changeState('show')">Generate Report</button>
  <hr />
  <h1>{{ header ? header : 'Mock Harvest Report' }}</h1>
  <p>Details:</p>
  <ul>
      <li><strong>Farm:</strong>{{farm}}</li>
      <li><strong>User:</strong>{{user}}</li>
      <li><strong>Language:</strong>{{language}}</li>
  </ul>
  <br />
  <ul>
      <li><strong>Start:</strong>{{startDate}}</li>
      <li><strong>End:</strong>{{endDate}}</li>
      <li><strong>Crop:</strong>{{rpCrops}}</li>
  </ul>
  <br>
  <table border="1">
      <colgroup span="5"></colgroup>
      <tr v-if="harvestLogs.length > 0">
      <th>Row</th>
      <th>Date</th>
      <th>Area</th>
      <th>Crop</th>
      <th>Yield</th>
      <th>Units</th>
      </tr>
      
      <p v-else>No available records. Please update your search.</p>

      <tr v-for="(log, index) in harvestLogs">
          <td>{{index + 1}}</td>
          <td>{{log.date}}</td>
          <td>{{log.area}}</td>
          <td>{{log.crop}}</td>
          <td>{{log.yield}}</td>
          <td>{{log.units}}</td>
      </tr>
  </table>
  <br />
</div>

<script>
  var myReport = new Vue({
    el: "#report",
    data: {
      header: "My Sample Harvest Report",
      state: "default",
      startDate:"",
      endDate: "",
      rpCrops: "",
      crops: [
                "Broccoli",
                "Kale",
                "Peas"
            ],
      areas: [
                "All",
                "Chuau-1",
                "SQ7",
             ],
      logs: [
                {date: "2014-01-01", 
                area: "Chuau-1", 
                crop: "Kale", 
                yield: 10, 
                units: "Bunches"},
                {date: "2018-01-01", 
                area: "All", 
                crop: "Broccoli", 
                yield: 5, 
                units: "Bunches"},
                {date: "2020-05-01", 
                area: "SQ7", 
                crop: "Peas", 
                yield: 20, 
                units: "Bunches"},
            ],
      harvestLogs: [],
      farm: "",
      user: "",
      language: "",
      idToCropMap: new Map(),
      idToAreaMap: new Map(),
    },
    methods: {
        logHarvests: function() {
            if (this.state === "default") {
                if (this.harvestLogs.length === 0) {
                    this.harvestLogs.push({date: '2014-01-01', area: 'Chuau-1', crop: 'Kale', yield: '10', units: 'Bunches'})
                } else if (this.harvestLogs.length === 1) {
                    this.harvestLogs.push({date: '2018-01-01', area: 'All', crop: 'Broccoli', yield: '5', units: 'Bunches'})
                } else if (this.harvestLogs.length === 2) {
                    this.harvestLogs.push({date: '2020-05-01', area: 'SQ7', crop: 'Peas', yield: '20', units: 'Bunches'})
                }
                }
            },
        changeState: function() {
            this.state = newState;
        },
        setUserInfo: function() {
            axios.get('/farm.json')
                  .then((response) => {
                      this.farm = response.data.name;
                      this.user = response.data.user.name;
                      this.language = response.data.languages.en.name;
                      console.log(response);
                  })
                  .catch((error) => {
                      console.log("Error Occurred.");
                      console.log(error);
                  })
        }
    },
    created() {
      getIDToCropMap()
            .then((map) => {
                this.idToCropMap = map;
            })
            .catch((error) => {
                console.log("Error occurred.");
                console.log(error);
            }),
      getIDToAreaMap()
            .then((map) => {
                this.idToAreaMap = map;
            })
            .catch((error) => {
                console.log("Error occurred.");
                console.log(error);
            })
    },
    computed: {
            cropNames() {
                cropNames = [];
                for (var name of this.idToCropMap.values()) {
                    cropNames.push(name);
                }
                return cropNames
            },
            areaNames() {
                areaNames = [];
                for (var name of this.idToAreaMap.values()) {
                    areaNames.push(name);
                }
                return areaNames
            }
        }
  });
  Vue.config.devtools = true;
</script>
