<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Harvest Report</title>
  </head>
  <body>
    <div id="pageContent" v-cloak>
        <h1>Harvest Report</h1>
        <p>This page is a <i>mockup</i> of a simplified harvest report.</p>
        <label for="title">Title:</label>
        <input type="text" id="title" name="title" v-model="reportTitle"/>
        <br><br>
        <label for="start">Start:</label>
            <input type="date" id="start" name="start"
            v-model="reportStartDate"
            min="2014-01-01" :max="reportEndDate">
            <label for="end">End:</label>
            <input type="date" id="end" name="end"
                v-model="reportEndDate"
                :min="reportStartDate" max="2022-01-01">
        <br><br>
        <label for="crop">Crop:</label>
        <select id="crop" name="crop" v-model="reportCrop">
            <option selected v-for="crop in cropNames">{{crop}}</option>
        </select>
        <label for="field">Field:</label>
        <select id="field" name="field">
            <option selected v-for="area in areaList">{{area}}</option>
        </select>
        <br><br>
        <input type="button" value="Generate Report" @click="addHarvestLog">
        <div v-if="showReport === 'true'">
            <hr>
            <h1>{{reportTitle ? reportTitle:"Mock Harvest Report"}}</h1>
            <p>Details:
                <ul> 
                    <li><strong>Farm:</strong>{{reportFarm}}</li>
                    <li><strong>User:</strong>{{reportUser}}</li>
                    <li><strong>Language:</strong>{{reportLanguage}}</li>
                    <br>
                    <li><strong>Start:</strong>{{reportStartDate}}</li>
                    <li><strong>End:</strong>{{reportEndDate}}</li>
                    <li><strong>Crop:</strong>{{reportCrop}}</li>
                </ul>
            </p>
            <table v-if="harvestLogList.length > 0" border = 1>
                <tr>
                    <th>Row</th>
                    <th>Date</th>
                    <th>Area</th>
                    <th>Crop</th>
                    <th>Yield</th>
                    <th>Unit</th>
                    <th>Delete</th>
                </tr>
                <tr v-for="(harvestLog,index) in harvestLogList">
                    <td>{{index+1}}</td>
                    <td>{{harvestLog.date}}</td>
                    <td>{{harvestLog.area}}</td>
                    <td>{{harvestLog.crop}}</td>
                    <td>{{harvestLog.yield}}</td>
                    <td>{{harvestLog.units}}</td>
                    <td><button type="button" @click="harvestLogList.splice(index, 1)">Delete</button></td>
                </tr>
            </table>
            <p v-else>No matching records found</p>
        </div>
    </div>
    <script>
        let mainVue = new Vue({
            el: "#pageContent",
            created() {
	            getIDToCropMap()
                .then((theMap) => {
                    this.$data.idToCropMap = theMap
                })
                .catch((err) => {
                    console.log("Error Occurred")
                    console.log(error)
                })
            },
            data:{
                reportTitle: "My Sample Report",
                reportStartDate: "2020-05-05",
                reportEndDate: "2020-05-15",
                reportCrop: "Kale",
                reportFarm: "",
                reportUser: "",
                reportLanguage: "",
                
                areaList: [
                    "All",
                    "Chuau-1",
                    "SQ7"
                ],
                harvestLogList:[
  
                ],
                showReport: "false",
                idToCropMap: new Map(),
            },
            computed:{
                cropNames(){
                    return Array.from(this.$data.idToCropMap.values());
                }
            },
            methods:{
                addHarvestLog: function(){
                    if(this.showReport === "false"){
                        axios.get('/farm.json')
                        .then((response) => {
                            this.$data.reportFarm = response.data.name
                            this.$data.reportUser = response.data.user.name
                            this.$data.reportLanguage = response.data.languages.en.name
                        })
                        .catch((error) => {
                            console.log("Error Occurred")
                            console.log(error)
                        })
                        this.showReport = 'true'
                    }
                    else{
                        if(this.harvestLogList.length==0){
                            this.harvestLogList.push({date:"2018-05-01", area:"Orion-3", crop:"Kale", yield:12, units:"Bunches"});
                        }      
                        else if (this.harvestLogList.length==1){
                            this.harvestLogList.push({date:"2018-05-01", area:"Orion-3", crop:"Carrots", yield:10, units:"Bunches"});
                        }
                        else if (this.harvestLogList.length==2){
                            this.harvestLogList.push({date:"2018-05-01", area:"Orion-3", crop:"Spinach", yield:1, units:"Bunches"});
                        }
                    }
                }
            }
        });
        Vue.config.devtools = true;
    </script>
  </body>
</html>